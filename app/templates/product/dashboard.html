{% extends 'base.html' %} {% block title %}Product Dashboard{% endblock %} {%
block body %}
<!-- Toast Notification -->
<div class="toast-container position-fixed top-5 p-2" style="z-index: 1080">
  {% with messages = get_flashed_messages(with_categories=true) %} {% if
  messages %} {% for category, message in messages %} {% if category ==
  'register_pm1' or category == 'delete' or category == 'product' %}
  <div
    class="toast align-items-center text-white bg-secondary border-0"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body">{{ message | safe }}</div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
        aria-label="Close"
      ></button>
    </div>
  </div>
  {% endif %} {% endfor %} {% endif %} {% endwith %}
</div>

<!-- Cards for Products, Average Reviews, and Products Sold Count -->
<div class="container my-5">
  <div class="row g-4">
    <!-- Products Card -->
    <div class="col-md-4">
      <div class="card shadow-sm border-0 rounded-4 bg-light h-100">
        <div class="card-body d-flex justify-content-center align-items-center">
          <div class="me-4 text-primary fs-1">
            <i class="bi bi-box-seam"></i>
          </div>
          <div>
            <h5 class="card-title fw-bold text-dark mb-1">Total Products</h5>
            <h4 class="text-dark">{{product_count}}</h4>
          </div>
        </div>
      </div>
    </div>
    <!-- Dicounts Card -->
    <div class="col-md-4">
      <div class="card shadow-sm border-0 rounded-4 bg-light h-100">
        <div class="card-body d-flex justify-content-center align-items-center">
          <div class="me-4 text-primary fs-1">
            <i class="bi bi-percent"></i>
          </div>
          <div>
            <h5 class="card-title fw-bold text-dark mb-1">Discounts</h5>
            <h4 class="text-dark">{{discounts_count}}</h4>
          </div>
        </div>
      </div>
    </div>
    <!-- Orders Card -->
    <div class="col-md-4">
      <div class="card shadow-sm border-0 rounded-4 bg-light h-100">
        <div class="card-body d-flex justify-content-center align-items-center">
          <div class="me-4 text-primary fs-1">
            <i class="bi bi-bag-check-fill"></i>
          </div>
          <div>
            <h5 class="card-title fw-bold text-dark mb-1">
              Total Customer Orders
            </h5>
            <h4 class="text-dark">{{orders_count}}</h4>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<hr />

<div class="container my-3 d-flex justify-content-end">
  <nav>
    <div class="nav nav-tabs mx-5" id="nav-tab" role="tablist">
      <button
        class="nav-link active text-dark"
        id="nav-home-tab"
        data-bs-toggle="tab"
        data-bs-target="#nav-home"
        type="button"
        role="tab"
        aria-controls="nav-home"
        aria-selected="true"
      >
        Products
      </button>
      <button
        class="nav-link text-dark"
        id="nav-profile-tab"
        data-bs-toggle="tab"
        data-bs-target="#nav-profile"
        type="button"
        role="tab"
        aria-controls="nav-profile"
        aria-selected="false"
      >
        Discounts
      </button>
      <button
        class="nav-link text-dark"
        id="nav-contact-tab"
        data-bs-toggle="tab"
        data-bs-target="#nav-contact"
        type="button"
        role="tab"
        aria-controls="nav-contact"
        aria-selected="false"
      >
        Customer Orders
      </button>
    </div>
  </nav>

  <!-- Registration Button   -->
  <a href="{{ url_for('product.add_product') }}">
    <button
      class="btn btn-dark border border-2 border-light rounded-4 justify-content-end mx-2"
      type="button"
    >
      Add New Product
    </button>
  </a>

  <!-- Discount Button -->
  <a href="{{ url_for('product.discount') }}">
    <button
      class="btn btn-dark border border-2 border-light rounded-4 justify-content-end"
      type="button"
    >
      Add Discount
    </button>
  </a>
</div>

<div class="tab-content my-2" id="nav-tabContent">
  <div
    class="tab-pane fade show active"
    id="nav-home"
    role="tabpanel"
    aria-labelledby="nav-home-tab"
    tabindex="0"
  >
    <!-- Products Table -->
    <div class="container-fluid">
      <table
        id="productTable"
        class="table table-striped table-bordered align-middle text-center"
      >
        <thead class="table-dark">
          <tr>
            <th>Sr. No.</th>
            <th>Product Name</th>
            <!-- <th>Description</th> -->
            <th>Price</th>
            <th>Quantity</th>
            <th>Category</th>
            <th>Show Image</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for product in products %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ product.name }}</td>
            <!-- <td>{{ product.description }}</td> -->
            <td>{{ product.price }}</td>
            <td>{{ product.quantity }}</td>
            <td>{{ product.category.name if product.category else 'N/A' }}</td>
            <td>
              <a
                href="{{ product.image }}"
                target="_blank"
                rel="noopener noreferrer"
                class="btn btn-secondary rounded-4 m-1"
                >Tap</a
              >
            </td>
            <td>
              {% if product.available and product.quantity > 0 %}
              <span class="badge bg-success">ACTIVE</span>
              {% else %}
              <span class="badge bg-danger">INACTIVE</span>
              {% endif %}
            </td>
            <td>
              <a href="{{ url_for('product.update', id=product.id) }}">
                <button type="button" class="btn btn-primary rounded-4 m-1">
                  <i class="bi bi-pencil-square"></i></button
              ></a>
              <a
                href="{{ url_for('product.delete', id=product.id) }}"
                onclick="return confirm('Are you sure you want to delete this product ?');"
              >
                <button type="button" class="btn btn-danger rounded-4 m-1">
                  <i class="bi bi-trash3-fill"></i>
                </button>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <br />
  </div>
  <div
    class="tab-pane fade"
    id="nav-profile"
    role="tabpanel"
    aria-labelledby="nav-profile-tab"
    tabindex="0"
  >
    <!-- Discounts Table -->
    <div class="container-fluid">
      <table
        id="discountTable"
        class="table table-striped table-bordered align-middle text-center"
      >
        <thead class="table-dark">
          <tr>
            <th>Sr. No.</th>
            <th>Name</th>
            <th>Description</th>
            <th>Type</th>
            <th>Value</th>
            <th>Created At</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for discounts in discounts %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ discounts.name }}</td>
            <td>{{ discounts.description }}</td>
            <td>{{ discounts.discount_type.value }}</td>
            <td>{{ discounts.value }}</td>
            <td>{{ discounts.created_at }}</td>
            <td>
              <a
                href="{{ url_for('product.deleteDiscount', id=discounts.id) }}"
                onclick="return confirm('Are you sure you want to delete this product ?');"
              >
                <button type="button" class="btn btn-danger rounded-4 m-1">
                  <i class="bi bi-trash3-fill"></i>
                </button>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <br />
  </div>
  <div
    class="tab-pane fade"
    id="nav-contact"
    role="tabpanel"
    aria-labelledby="nav-contact-tab"
    tabindex="0"
  >
    <!-- Customer Orders Table -->
    <div class="container-fluid">
      <table
        id="customerOrdersTable"
        class="table table-striped table-bordered align-middle text-center"
      >
        <thead class="table-dark">
          <tr>
            <th>Sr. No.</th>
            <th>Customer Name</th>
            <th>Email</th>
            <th>Order ID</th>
            <th>Amount Paid</th>
            <th>Status</th>
            <th>Ordered On</th>
          </tr>
        </thead>
        <tbody>
          {% for order in orders %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ order.user.fname }} {{ order.user.lname }}</td>
            <td>{{ order.user.email }}</td>
            <td>#{{ order.id }}</td>
            <td>${{ order.amount }}</td>
            <td>
              <span class="badge bg-success">{{ order.status.value }}</span>
            </td>
            <td>{{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <br />
  </div>
</div>
{% endblock %}
