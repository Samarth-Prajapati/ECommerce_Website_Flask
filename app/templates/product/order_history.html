{% extends 'base.html' %} {% block title %}My Orders{% endblock %} {% block body
%}

<!-- Toast Notification -->
<div class="toast-container position-fixed top-5 p-2" style="z-index: 1080">
  {% with messages = get_flashed_messages(with_categories=true) %} {% if
  messages %} {% for category, message in messages %} {% if category ==
  'register_pm1' or category == 'cart' or category == 'product' %}
  <div
    class="toast align-items-center text-white bg-secondary border-0"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body">{{ message | safe }}</div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
        aria-label="Close"
      ></button>
    </div>
  </div>
  {% endif %} {% endfor %} {% endif %} {% endwith %}
</div>

<div class="container my-5">
  <h2 class="mb-4 fw-bold text-dark text-center">ðŸ›’ Order History</h2>

  {% if orders %}
  <div class="table-responsive rounded-4 shadow-sm">
    <table class="table table-bordered align-middle text-center">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Order ID</th>
          <th>Status</th>
          <th>Amount</th>
          <th>Payment ID</th>
          <th>Date</th>
          <th>Invoice</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>#{{ order.id }}</td>
          <td>{{ order.status.name }}</td>
          <td>$ {{ order.amount }}</td>
          <td>{{ order.payment_id or '-' }}</td>
          <td>{{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
          <td>
            {% if order.invoice %}
            <a
              href="{{ url_for('static', filename=order.invoice) }}"
              target="_blank"
              class="btn btn-sm btn-outline-dark rounded-5"
              download="invoice.pdf"
              ><i class="bi bi-arrow-down"></i
            ></a>
            {% else %} - {% endif %}
          </td>
          <td>
            {% set all_products_available = true %} {% for item in
            order.order_items %} {% if not item.product or not
            item.product.is_active or not item.product.available or
            item.product.quantity <= 0 %} {% set all_products_available = false
            %} {% endif %} {% endfor %} {% if all_products_available %}
            <form
              action="{{ url_for('customer.order_again', order_id=order.id) }}"
              method="post"
            >
              <input
                type="hidden"
                name="csrf_token"
                value="{{ csrf_token() }}"
              />
              <button
                class="btn btn-sm btn-outline-dark rounded-4"
                type="submit"
                onclick="return confirm('Reorder all items from this order?')"
              >
                <i class="bi bi-arrow-repeat"></i> Order Again
              </button>
            </form>
            {% else %}
            <button class="btn btn-sm btn-outline-secondary rounded-4" disabled>
              <i class="bi bi-arrow-repeat"></i> Unavailable
            </button>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="alert alert-info mt-4 text-center">
    You have not placed any orders yet.
  </div>
  {% endif %}
</div>

{% endblock %}
